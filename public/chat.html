<!-- Add this input inside the container, above username -->
<input type="text" id="name" placeholder="Full Name" />

<script>
  // Inside your submitBtn event listener update validation and request body:

  submitBtn.addEventListener('click', async () => {
    messageBox.textContent = '';
    const name = document.getElementById('name').value.trim();
    const username = usernameInput.value.trim();
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    const confirmPassword = confirmPasswordInput.value;

    if (!email || !password || (!isLogin && (!username || !name))) {
      messageBox.textContent = 'Please fill in all required fields.';
      return;
    }

    if (!isLogin && password !== confirmPassword) {
      messageBox.textContent = 'Passwords do not match.';
      return;
    }

    if (!isLogin && (/\s|#/.test(username))) {
      messageBox.textContent = 'Username cannot contain spaces or #.';
      return;
    }

    const action = isLogin ? 'login' : 'register';

    try {
      const res = await fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ action, name, username, email, password }),
      });

      const data = await res.json();

      if (data.success) {
        localStorage.setItem('chatUser', JSON.stringify(data.user));
        window.location.href = 'arena.html';
      } else {
        messageBox.textContent = data.message || 'Operation failed.';
      }
    } catch {
      messageBox.textContent = 'Server error.';
    }
  });

  // Also toggle visibility of #name input in the toggleForm event:
  toggleForm.addEventListener('click', () => {
    isLogin = !isLogin;
    if (isLogin) {
      formTitle.textContent = 'Login';
      nameInput.style.display = 'none';
      usernameInput.style.display = 'none';
      confirmPasswordInput.style.display = 'none';
      submitBtn.textContent = 'Login';
      toggleForm.textContent = "Don't have an account? Sign Up";
    } else {
      formTitle.textContent = 'Sign Up';
      nameInput.style.display = 'block';
      usernameInput.style.display = 'block';
      confirmPasswordInput.style.display = 'block';
      submitBtn.textContent = 'Register';
      toggleForm.textContent = 'Already have an account? Login';
    }
    resetForm();
  });

  // Make sure to define `const nameInput = document.getElementById('name');`
</script>
